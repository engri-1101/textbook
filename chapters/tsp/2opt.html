
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1.4. Improving Tours: 2-OPT &#8212; Data Science and Decision Making: An Elementary Introduction to Modeling and Optimization</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.5. Modeling with the Traveling Salesman Problem" href="tsp_modeling1.html" />
    <link rel="prev" title="1.3. Heuristics" href="heuristics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Data Science and Decision Making: An Elementary Introduction to Modeling and Optimization</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/what_is_or.html">
   What is Operations Research?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/python_intro.html">
   Introduction to Python and Mathematical Syntax
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="intro1.html">
   1. The Traveling Salesman Problem
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="model1.html">
     1.1. Mathematical Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="algorithms1.html">
     1.2. Solving a Problem – Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="heuristics.html">
     1.3. Heuristics
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     1.4. Improving Tours: 2-OPT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tsp_modeling1.html">
     1.5. Modeling with the Traveling Salesman Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vsli1.html">
     1.6. Etching VLSI Computer Chips
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="intro2.html">
   2. The Traveling Salesman Problem
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="prelab.html">
     2.1. Pre-Lab
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="model2.html">
     2.2. Mathematical Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="algorithms2.html">
     2.3. Solving a Problem – Algorithms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lab_heuristics.html">
     2.4. Lab: Heuristics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lab_2opt.html">
     2.5. Lab: 2-OPT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tsp_modeling2.html">
     2.6. Modeling with the Traveling Salesman Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="demo2.html">
     2.7. Demo: Radio Telescope
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lab_drilling.html">
     2.8. Lab: PCB Drilling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vsli2.html">
     2.9. Etching VLSI Computer Chips
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lab_etching.html">
     2.10. Lab: PCB Etching
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/engri-1101/textbook/textbook?urlpath=tree/src/chapters/tsp/2opt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/engri-1101/textbook"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/engri-1101/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/tsp/2opt.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/engri-1101/textbook/edit/textbook/src/chapters/tsp/2opt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/chapters/tsp/2opt.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Improving Tours: 2-OPT</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="improving-tours-2-opt">
<h1><span class="section-number">1.4. </span>Improving Tours: 2-OPT<a class="headerlink" href="#improving-tours-2-opt" title="Permalink to this headline">#</a></h1>
<p>Above we used heuristics to create TSP tours. However, we can also use heuristics to try and improve tours we have already found. First, let’s think about how we may try improving a tour.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Look at the tour above. How might you improve this tour? How could you generalize this strategy?</p>
<div class="toggle docutils container">
<p><strong>A:</strong> There are two edges that cross and we could switch them around! We can generalize this by finding edges that could improve by a switch and making switches until there are no more switches.</p>
</div>
<p>We will examine a tour improvement heuristic called 2-OPT in this part. 2-OPT looks for pairs of edges which can be reconnected to strictly improve the tour cost. (Note: there is only one way to reconnect a pair of edges). It continues in this fashion until no more improvements can be made. Let’s run 2-OPT on our example from above! We will use <code class="docutils literal notranslate"><span class="pre">plot_two_opt</span></code> to  generate a visualization of 2-OPT. In each iteration, 2 edges will be highlighted red and 2 will be highlighted blue. The red edges indicate the current position and the blue indicate the positon they will be reconnected in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will run 2-OPT after the nearest neighbor heuristic on a 5x5 (euclidian distance) example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, we run the nearest neighbor heuristic to get an initial tour</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Run 2-OPT a few times. Do you get the same result every time? Why or why not?</p>
<div class="toggle docutils container">
<p><strong>A:</strong> Yes. There is no randomness in this algorithm.</p>
</div>
<p>Let’s run 2-OPT a few times on a slightly larger grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> After running 2-OPT, do you ever get a tour which crosses itself? When using euclidian distances, is this even possible? Explain why or why not.</p>
<div class="toggle docutils container">
<p><strong>A:</strong> No. This is not possible. Assume you have a tour that crosses itself. Consider the two edges that cross. You can always reconnect them to be cheaper. Hence, 2-OPT has not been run to completion. It follows that 2-OPT always terminates with a tour with no crosses.</p>
</div>
<p>Let’s compare the heuristics with and without executing 2-OPT. While we are at it, let’s compare to the optimal solution which has already been computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">optimal_tour</span><span class="p">(</span><span class="s1">&#39;6x6_grid&#39;</span><span class="p">)</span>
<span class="n">optimal_cost</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">nearest_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_neighbor_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">optimal_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">nearest_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">furthest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_neighbor_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
    <span class="n">nearest_insertion_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
    <span class="n">furthest_insertion_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_cost</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Compare the heuristics to their before and after 2-OPT performance. Compare them to the optimal.</p>
<div class="toggle docutils container">
<p><strong>A:</strong> The nearest neighbor heuristic improved the most from 2-OPT. Both nearest and furthest insertion were often not improved by 2-OPT and came very close to the optimal. After running 2-OPT, the nearest neighbor heuristic was <em>near</em> optimal as well.</p>
</div>
<p>For fun, let’s go back to the 23 US city example. Let’s run 2-OPT on the tour you created in <strong>Pre-Lab</strong> (or a new one if you would like). To do this, you will need to define the tour as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">create_network</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">create_tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;images/us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Set the <code class="docutils literal notranslate"><span class="pre">tour</span></code> variable to be the tour you manually created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can define a tour like this:</span>
<span class="n">tour</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span>

<span class="c1"># After manually creating a tour, you can copy the list associated with that tour from the bottom-right</span>

<span class="c1"># TODO: Define your tour.</span>
<span class="n">tour</span> <span class="o">=</span>
</pre></div>
</div>
</div>
</div>
<p>Run 2-OPT!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;images/us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Did 2-OPT improve your tour? By how much?</p>
<div class="toggle docutils container">
<p><strong>A:</strong> (Based on example tour) Yes. It went from 9592.0 to 8356.8.</p>
</div>
<p>Now, let’s look at an optimal solution!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tour</span> <span class="o">=</span> <span class="n">optimal_tour</span><span class="p">(</span><span class="s1">&#39;us_cities_23&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;images/us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Was your tour optimal before or after 2-OPT?</p>
<div class="toggle docutils container">
<p><strong>A:</strong> (Based on example tour) It was not optimal before 2-OPT but it become optimal afterwards!</p>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "engri-1101/textbook",
            ref: "textbook",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters\tsp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="heuristics.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1.3. </span>Heuristics</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tsp_modeling1.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.5. </span>Modeling with the Traveling Salesman Problem</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By David B. Shmoys, Samuel C. Gutekunst, Frans Schalekamp, and David P. Williamson<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>