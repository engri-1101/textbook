

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>1.2. Solving a Problem – Algorithms &#8212; Data Science and Decision Making: An Elementary Introduction to Modeling and Optimization</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/tsp/algorithms_web';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.3. Modeling with the Traveling Salesman Problem" href="tsp_modeling_web.html" />
    <link rel="prev" title="1.1. Mathematical Model" href="model_web.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../cover.html">
  
  
  
  
  
    <p class="title logo__title">Data Science and Decision Making: An Elementary Introduction to Modeling and Optimization</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/what_is_or.html">What is Operations Research?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/python_intro.html">Introduction to Python and Mathematical Syntax</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Textbook</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro_web.html">1. The Traveling Salesman Problem</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="model_web.html">1.1. Mathematical Model</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">1.2. Solving a Problem – Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsp_modeling_web.html">1.3. Modeling with the Traveling Salesman Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="vlsi_web.html">1.4. Etching VLSI Computer Chips</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../shortest_path/intro_web.html">2. The Shortest Path Problem</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../shortest_path/model_web.html">2.1. Mathematical Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shortest_path/algorithm_web.html">2.2. Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shortest_path/verify_web.html">2.3. Verifying a Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shortest_path/modeling_with_web.html">2.4. Modeling with Shortest Paths</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../max_flow/intro_web.html">3. The Maximum Flow Problem</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../max_flow/model_web.html">3.1. Mathematical Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../max_flow/verify_web.html">3.2. Verifying a Solution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../max_flow/towards_algorithm_web.html">3.3. Towards an Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../max_flow/algorithms_web.html">3.4. Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../max_flow/algorithms_python_web.html">3.5. Ford-Fulkerson in Python</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/engri-1101/textbook/textbook?urlpath=tree/src/chapters/tsp/algorithms_web.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/engri-1101/textbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/engri-1101/textbook/edit/textbook/src/chapters/tsp/algorithms_web.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/engri-1101/textbook/issues/new?title=Issue%20on%20page%20%2Fchapters/tsp/algorithms_web.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/chapters/tsp/algorithms_web.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Solving a Problem – Algorithms</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heuristics">Heuristics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-tours-2-opt">Improving Tours: 2-OPT</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="solving-a-problem-algorithms">
<h1><span class="section-number">1.2. </span>Solving a Problem – Algorithms<a class="headerlink" href="#solving-a-problem-algorithms" title="Permalink to this heading">#</a></h1>
<p>Let us return to the definition of operations research given in the previous handout. One aspect that we did not touch upon is that we require the mathematical model be <em>analyzed</em>, so it can provide guidance in the given decision-making setting. For an optimization model, the element is thereby an algorithm, a computation procedure that can solve the task at hand. And just as we have described a generic computational task, there should also be a generic procedure that can handle all possible inputs. One can think of this as a sufficiently robust software package that can handle any of the inputs you might “reasonably” want to solve.</p>
<p>For the traveling salesman problem, there is a quite simple algorithm that is guaranteed to produce an optimal solution. One might “simply” enumerate all possible permutations, one after the other, evaluate the cost associated with each permutation, and then output the permutation with the cheapest cost. This certainly works correctly for any input. So are we done? Actually, no. The problem is that there are too many permutations for this to be of much practical use. For <span class="math notranslate nohighlight">\(n=100\)</span>, how many permutations are there? There are 100 choices for the first city, and for each of those there are 99 choices for the second, and then 98 for the third, and so forth. So it seems like there are <span class="math notranslate nohighlight">\(100!\)</span> (100 factorial). However, this is a bit overdone because recall that it does not matter which city we start at, so in fact the same tour is counted 100 times. But <span class="math notranslate nohighlight">\(99!\)</span> is still big enough. It is greater than <span class="math notranslate nohighlight">\(10^{155}\)</span>, which is more than the number of atoms in our universe.</p>
<p>Therefore, the simple algorithm is too slow. There are a few options to consider. One approach is to develop much more sophisticated algorithms. Throughout this course, you will learn many of the elements used by the best solver for the traveling salesman problem, a package called Concorde (which you can install on your iPhone - you are encouraged to do so). Concorde can easily solve inputs with 1000’s or even 10,000 cities, but even that code has its limits.</p>
<p>Another approach is to design simple algorithms that do not necessarily produce an optimal solution but instead produce good solutions. One natural one is called the <em>nearest neighbor rule</em>: start at one city and iteratively choose the next city as the one not yet visited that is currently nearest. There are a number of simple algorithms such as this one that will be demonstrated below.</p>
<section id="heuristics">
<h2>Heuristics<a class="headerlink" href="#heuristics" title="Permalink to this heading">#</a></h2>
<p>A <em>heuristic</em> aims to find a good feasible solution to a problem although it is not guaranteed to be optimal. We will consider 4 different TSP heuristics. Before we move on, we will abstract the TSP to finding an optimal tour on a set of <em>nodes</em> rather than cities. These nodes can represent anything.</p>
<p>To compare the heuristics, we will use a simple 6x8 grid of nodes. The cell below creates this instance. Note that we will initially use the Manhattan distance.</p>
<div class="cell tag_thebe-init tag_hide-cell tag_web-only docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="s1">&#39;https://engri-1101.github.io/textbook/modules/tsp.py&#39;</span><span class="p">,</span> <span class="s2">&quot;tsp.py&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">tsp</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="s1">&#39;https://engri-1101.github.io/textbook/data/tsp/optimal_tours.pickle&#39;</span><span class="p">,</span> <span class="s2">&quot;optimal_tours.pickle&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">vinal</span> <span class="k">as</span> <span class="nn">vl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span>
<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>1. <strong>Random Neighbor:</strong> Start at some node. Randomly select one of the nodes which has not been visited to visit next. Continue doing so until all nodes have been visited. Return to the start.</p>
<p>Let’s use random neighbor (a terrible heuristic) to get a baseline for the cost of a tour. We will use a function called <code class="docutils literal notranslate"><span class="pre">plot_tsp_heuristic</span></code> to see the mechanics of the algorithm. Run the cell, and use the <code class="docutils literal notranslate"><span class="pre">Previous</span></code> and <code class="docutils literal notranslate"><span class="pre">Next</span></code> buttons to move through the iterations of the algorithm. The tour cost will update in the bottom left. <code class="docutils literal notranslate"><span class="pre">done.</span></code> will appear in the bottom right when the heuristic has finished.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;random_neighbor&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To view the complete tour right away, we can use the function <code class="docutils literal notranslate"><span class="pre">random_neighbor</span></code> to run the random neighbor heuristic and the function <code class="docutils literal notranslate"><span class="pre">plot_tour</span></code> to plot the tour and its cost in the lower left.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">random_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="c1"># &#39;tour&#39; is an ordered list of the nodes starting and ending at the same node</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tour</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Does this look like a good tour to you? Run it a few times, and see what the average tour cost is.</p>
<p>2. <strong>Nearest Neighbor:</strong> Start at some node. Visit the closest unvisited node next (if there are multiple closest nodes, choose one randomly). Continue doing so until all nodes have been visited. Return to the start.</p>
<p>Now, let’s look at the nearest neighbor heuristic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;nearest_neighbor&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> As you iterate through, examine the “choices” made by the algorithm at each step. What does it do well? What does it do poorly?</p>
<p><strong>Q:</strong> Run this a few times. Do you get the same tour every time? Why or why not?</p>
<p>3. <strong>Nearest Insertion:</strong> Start with a “tour” on two of the nodes (e.g., the closest pair of nodes). Find the closest unvisited node to any node currently in the tour. Insert the node into the tour at the best place (if there are multiple closest nodes, choose one to add randomly).</p>
<p>Now, let’s look at the nearest insertion heuristic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;nearest_insertion&#39;</span><span class="p">,</span> <span class="n">initial_tour</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Run this a few times. How does it compare to the previous heuristics?</p>
<p>4. <strong>Furthest Insertion:</strong> Start with a “tour” on two of the nodes (e.g., the closest pair of nodes). Find the node whose smallest distance to a node already in the tour is maximized. Insert the node into the tour at the best place (if there are multiple furthest nodes, choose one to add randomly).</p>
<p>Now, let’s look at the furthest insertion heuristic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;furthest_insertion&#39;</span><span class="p">,</span> <span class="n">initial_tour</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">47</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Run this a few times. How does it compare to the previous heuristics?</p>
<p>To compare the heuristics further, let’s run each on the 6x8 grid say, 250 times.</p>
<p><strong>Q:</strong> Now that you have seen each heuristic, which do you think will do the best, and which will do the worst?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run each heuristic n times</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">random_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">random_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">random_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">furthest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Heuristic Averages:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Random Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">random_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> What were the results? Was this what you expected?</p>
<p>Let’s look at a 9x9 grid using the Euclidean distance now. Run each of the cells below to see each heuristic executed on the new instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Random neighbor</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">random_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nearest neighbor</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nearest insertion</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">initial_tour</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Furthest insertion</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">initial_tour</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> How did the results compare to the 6x8 grid using Manhattan distances?</p>
<p>Again, let’s run each heuristic numerous times and see how they compare.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">random_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">random_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">random_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">furthest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Heuristic Averages:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Random Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">random_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> How did the results compare to the 6x8 grid using Manhattan distances?</p>
</section>
<section id="improving-tours-2-opt">
<h2>Improving Tours: 2-OPT<a class="headerlink" href="#improving-tours-2-opt" title="Permalink to this heading">#</a></h2>
<p>Above we used heuristics to create TSP tours. However, we can also use heuristics to try and improve tours we have already found. First, let’s think about how we may try improving a tour.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a new tour</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Look at the tour above. How might you improve this tour? How could you generalize this strategy?</p>
<p>We will examine a tour improvement heuristic called <em>2-OPT</em> in this part. 2-OPT looks for pairs of edges which can be reconnected to strictly improve the tour cost. (Note: There is only one way to reconnect a pair of edges.) It continues in this fashion until no more improvements can be made. Let’s run 2-OPT on the 4x4 example. We will use <code class="docutils literal notranslate"><span class="pre">plot_two_opt</span></code> to  generate a visualization of 2-OPT. In each iteration, 4 edges will be highlighted red: 2 solid and 2 dotted. The solid edges indicate the current position, and the dotted indicate the positon they will be reconnected in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we will run 2-OPT after the nearest neighbor heuristic on a 5x5 (Euclidean distance) example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, we run the nearest neighbor heuristic to get an initial tour</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run 2-OPT</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Run 2-OPT a few times. Do you get the same result every time? Why or why not?</p>
<p>Let’s run 2-OPT a few times on a slightly larger grid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> After running 2-OPT, do you ever get a tour that crosses itself? When using Euclidean distances, is this even possible? Explain why or why not.</p>
<p>Let’s compare the heuristics (besides random neighbor) with and without executing 2-OPT on a 6x6 example. While we are at it, let’s compare them to the optimal solution which has already been computed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">grid_instance</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">tour</span> <span class="o">=</span> <span class="n">optimal_tour</span><span class="p">(</span><span class="s1">&#39;6x6_grid&#39;</span><span class="p">)</span>
<span class="n">optimal_cost</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">nearest_neighbor_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_neighbor_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nearest_insertion_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">furthest_insertion_2_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">optimal_total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">nearest_neighbor_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">furthest_insertion_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
    <span class="n">nearest_neighbor_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_neighbor</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
    <span class="n">nearest_insertion_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">nearest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
    <span class="n">furthest_insertion_2_total</span> <span class="o">+=</span> <span class="n">vl</span><span class="o">.</span><span class="n">tour_cost</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">two_opt</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">vl</span><span class="o">.</span><span class="n">furthest_insertion</span><span class="p">(</span><span class="n">G</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Neighbor + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_neighbor_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nearest Insertion + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nearest_insertion_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Furthest Insertion + 2-OPT: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">furthest_insertion_2_total</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">optimal_cost</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Compare the heuristics by their before and after 2-OPT performance. Compare them to the optimal.</p>
<p>For fun, let’s go back to the 23 US city example. Let’s run 2-OPT on the tour you created in the previous section (or a new one if you would like). To do this, you will need to define the tour as follows:</p>
<div class="cell tag_web-only docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://engri-1101.github.io/textbook/data/tsp/us_cities_23.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">vl</span><span class="o">.</span><span class="n">create_network</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">manhattan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="s1">&#39;https://engri-1101.github.io/textbook/other/us.png&#39;</span><span class="p">,</span> <span class="s2">&quot;us.png&quot;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">create_tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Set the <code class="docutils literal notranslate"><span class="pre">tour</span></code> variable to be the tour you manually created.</p>
<div class="cell tag_web-only docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can define a tour like this:</span>
<span class="n">tour</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span>

<span class="c1"># After manually creating a tour, you can copy the list associated with that tour from the bottom-right</span>

<span class="c1"># TODO: Define your tour.</span>
</pre></div>
</div>
</div>
</div>
<p>Run 2-OPT!</p>
<div class="cell tag_web-only docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tsp_heuristic_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="s1">&#39;2-OPT&#39;</span><span class="p">,</span> <span class="n">tour</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tour</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Did 2-OPT improve your tour? By how much?</p>
<p>Now, let’s look at an optimal solution.</p>
<div class="cell tag_web-only docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tour</span> <span class="o">=</span> <span class="n">optimal_tour</span><span class="p">(</span><span class="s1">&#39;us_cities_23&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">tour_plot</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">tour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">375</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;us.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Q:</strong> Was your tour optimal before or after 2-OPT?</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "engri-1101/textbook",
            ref: "textbook",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters\tsp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="model_web.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.1. </span>Mathematical Model</p>
      </div>
    </a>
    <a class="right-next"
       href="tsp_modeling_web.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.3. </span>Modeling with the Traveling Salesman Problem</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#heuristics">Heuristics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#improving-tours-2-opt">Improving Tours: 2-OPT</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By David B. Shmoys, Samuel C. Gutekunst, Frans Schalekamp, and David P. Williamson
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>